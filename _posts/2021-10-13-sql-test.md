---
title: SQL공부를 조금이라도 하자[작성 중]
author: Sanghun lee
date: 2021-09-28 11:33:00 +0800
categories: [Blogging, SQL]
tags: [SQL]
math: true
mermaid: true
image:
  src: https://play-lh.googleusercontent.com/ZWYWjkdD41Rrw8r7tNjTvOePzGOVpq-zSk1yAD3wv4iWjUSgKzw_QVHgehPevnaotRo
  width: 850
  height: 585
---

# SQL

# 정리한 이유

매번 TypeORM의 엄청난 도움을 받으며 포트폴리오를 위한 서버를 구현하다가

팔로우 관계와 유사한 기능이 있는 경우

M:N으로 조인된 컬럼의 데이터를 지워줘야하는 필요성이 생겼다.

그래서 queryBuilder를 통해서 지워주는 방법이 있다는 것을 알게되고 간단한 방법으로 구현하게는 되었으나,

언젠가 SQL의 깊지는 않아도 간단한 문법은 구현할 수 있어야한다는 생각으로

[프로그래머스 문제-SQL 고득점 Kit](https://programmers.co.kr/learn/challenges)를 풀어보았다.

아래는 간략하게 풀며 정리한 내용이며 추가적으로 신기한 구현방법이 있으면 수정하겠다.

# 1. SELECT

### 모든 레코드 조회하기

동물 보호소에 들어온 모든 동물의 정보를 ANIMAL_ID순으로 조회하는 SQL문을 작성해주세요.

```sql
SELECT * FROM ANIMAL_INS ORDER BY ANIMAL_ID ASC
```

> ASC ,DEC 는 각 각 오름차순, 내림차순을 뜻한다.

### 역순 정렬하기

동물 보호소에 들어온 모든 동물의 이름과 보호 시작일을 조회하는 SQL문을 작성해주세요. 이때 결과는 ANIMAL_ID 역순으로 보여주세요.

```sql
SELECT NAME, DATETIME
FROM ANIMAL_INS
ORDER BY ANIMAL_ID DESC;
```

### 아픈 동물 찾기

```sql
SELECT ANIMAL_ID, NAME
FROM ANIMAL_INS
WHERE INTAKE_CONDITION
LIKE 'Sick'
ORDER BY ANIMAL_ID ASC;
```

문자열을 찾을때는 LIKE를 사용하자

추가적으로 %, \_가 있는데 앞뒤로 무시 or 무엇이든 을 뜻하게 된다

아래 간단한 두가지 예제를 보자

```sql
SELECT NAME
FROM ANIMAL_INS
WHERE INTAKE_CONDITION
LIKE '_Sick'
ORDER BY ANIMAL_ID ASC;
```

앞에 어떤 sick가 나오는 것을 찾게된다 ex)asick

```sql
SELECT NAME
FROM ANIMAL_INS
WHERE INTAKE_CONDITION
LIKE '&Sick'
ORDER BY ANIMAL_ID ASC;
```

앞에 어떤것이 나오든 sick가 들어있는 것을 찾게된다 ex)ㅁㄴㅇㄹㅁㅇㄴㄹㄴㅁㅇㄹㅁsick

조합해서도 사용 가능하다

### 어린 동물 찾기

동물 보호소에 들어온 동물 중 젊은 동물1의 아이디와 이름을 조회하는 SQL 문을 작성해주세요. 이때 결과는 아이디 순으로 조회해주세요.

```sql
SELECT ANIMAL_ID, NAME
FROM ANIMAL_INS
WHERE NOT INTAKE_CONDITION
LIKE 'Aged'
ORDER BY ANIMAL_ID ASC;
```

### 동물의 아이디와 이름

동물 보호소에 들어온 모든 동물의 아이디와 이름을 ANIMAL_ID순으로 조회하는 SQL문을 작성해주세요.

```sql
SELECT ANIMAL_ID, NAME
FROM ANIMAL_INS
ORDER BY ANIMAL_ID ASC;
```

### 여러 기준으로 정렬하기

동물 보호소에 들어온 모든 동물의 아이디와 이름, 보호 시작일을 이름 순으로 조회하는 SQL문을 작성해주세요. 단, 이름이 같은 동물 중에서는 보호를 나중에 시작한 동물을 먼저 보여줘야 합니다.

```sql
SELECT ANIMAL_ID, NAME, DATETIME
FROM ANIMAL_INS
ORDER BY NAME, DATETIME DESC;
```

### 상위 n개 레코드

동물 보호소에 가장 먼저 들어온 동물의 이름을 조회하는 SQL 문을 작성해주세요.

```sql
SELECT NAME FROM ANIMAL_INS
WHERE DATETIME = (SELECT MIN(DATETIME)
FROM ANIMAL_INS);
```

WHERE문을 써서 조건을 줄 수 있으며 GROUP BY로 묶여진 경우 HAVING문을 써주면 된다.

# 2. SUM, MAX, MIN

### 최댓값 구하기

가장 최근에 들어온 동물은 언제 들어왔는지 조회하는 SQL 문을 작성해주세요.

```sql
SELECT MAX(DATETIME) FROM ANIMAL_INS;
```

### 최솟값 구하기

동물 보호소에 가장 먼저 들어온 동물은 언제 들어왔는지 조회하는 SQL 문을 작성해주세요.

```sql
SELECT MIN(DATETIME) FROM ANIMAL_INS;
```

### 동물 수 구하기

동물 보호소에 동물이 몇 마리 들어왔는지 조회하는 SQL 문을 작성해주세요.

```sql
SELECT COUNT(*) FROM ANIMAL_INS;
```

### 중복 제거하기

동물 보호소에 들어온 동물의 이름은 몇 개인지 조회하는 SQL 문을 작성해주세요.

이때 이름이 NULL인 경우는 집계하지 않으며 중복되는 이름은 하나로 칩니다.

```sql
SELECT COUNT(DISTINCT NAME)
FROM ANIMAL_INS
WHERE NAME IS NOT NULL;
```

# 3. GROUP BY

### 고양이와 개는 몇 마리 있을까

동물 보호소에 들어온 동물 중 고양이와 개가 각각 몇 마리인지 조회하는 SQL문을 작성해주세요. 이때 고양이를 개보다 먼저 조회해주세요.

```sql
SELECT ANIMAL_TYPE, COUNT(ANIMAL_TYPE) FROM ANIMAL_INS GROUP BY ANIMAL_TYPE ORDER BY ANIMAL_TYPE
```

-> ORDER BY ANIMAL_TYPE 는 고양이를 먼저 조회하기 위해 사용

### 동명 동물 수 찾기

동물 보호소에 들어온 동물 이름 중 두 번 이상 쓰인 이름과 해당 이름이 쓰인 횟수를 조회하는 SQL문을 작성해주세요. 이때 결과는 이름이 없는 동물은 집계에서 제외하며, 결과는 이름 순으로 조회해주세요.

#### 1.첫번째 시도

```sql
SELECT NAME, COUNT(NAME) FROM ANIMAL_INS WHERE COUNT(NAME)>=1 GROUP BY NAME ORDER BY NAME
```

그룹을 묶은 다음 조건을 쓰기 위해서는 HAVING을 써야한다고 한다..

#### 2.두번째 시도

```sql
SELECT NAME, COUNT(NAME) FROM ANIMAL_INS GROUP BY NAME HAVING COUNT(NAME)>1 ORDER BY NAME
```

### 입양 시각 구하기(1)

보호소에서는 몇 시에 입양이 가장 활발하게 일어나는지 알아보려 합니다. 09:00부터 19:59까지, 각 시간대별로 입양이 몇 건이나 발생했는지 조회하는 SQL문을 작성해주세요. 이때 결과는 시간대 순으로 정렬해야 합니다.

```sql
SELECT HOUR(DATETIME), COUNT(HOUR(DATETIME)) FROM ANIMAL_OUTS GROUP BY HOUR(DATETIME) HAVING HOUR(DATETIME) >= 09 AND HOUR(DATETIME) < 20 ORDER BY HOUR
```

아래와 같이 변수선언 쌉가능 ...

```sql
SELECT HOUR(DATETIME) HOUR, COUNT(DATETIME) FROM ANIMAL_OUTS GROUP BY HOUR(DATETIME) HAVING HOUR >= 9 AND HOUR < 20 ORDER BY HOUR

```

### 입양 시각 구하기(2)

이문제는 처음에 입양 시각 구하기(1)의 문제와 유사하게 작성하였는데 0~23이라는 범위에서 아는 지식을 넘어갔으므로 .. 검색을 열심히했다 :)

```sql
SET @hour := -1;

SELECT (@hour := @hour + 1) as HOUR,
(SELECT COUNT(*) FROM ANIMAL_OUTS WHERE HOUR(DATETIME) = @hour) as COUNT
FROM ANIMAL_OUTS
WHERE @hour < 23;
```

## 참고

- [w3school-SQL Tutorial](https://www.w3schools.com/sql/sql_between.asp)
- [프로그래머스 문제-SQL 고득점 Kit](https://programmers.co.kr/learn/challenges)
