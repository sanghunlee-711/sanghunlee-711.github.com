<!DOCTYPE html><html lang="ko" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="day-prompt" content="days ago"><meta name="hour-prompt" content="hours ago"><meta name="minute-prompt" content="minutes ago"><meta name="justnow-prompt" content="just now"><meta name="generator" content="Jekyll v4.2.2" /><meta property="og:title" content="리액트에서 비즈니스 로직을 나눠보자[2 - Hooks 를 테스트 해보자]" /><meta name="author" content="Sanghun lee" /><meta property="og:locale" content="ko" /><meta name="description" content="테스트 코드 작성해보기" /><meta property="og:description" content="테스트 코드 작성해보기" /><link rel="canonical" href="https://sanghunlee-711.github.io//posts/refactoring-2/" /><meta property="og:url" content="https://sanghunlee-711.github.io//posts/refactoring-2/" /><meta property="og:site_name" content="Sanghun Lee" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2022-01-18T12:33:00+09:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="리액트에서 비즈니스 로직을 나눠보자[2 - Hooks 를 테스트 해보자]" /><meta name="twitter:site" content="@twitter_username" /><meta name="twitter:creator" content="@Sanghun lee" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Sanghun lee"},"dateModified":"2022-01-18T22:57:40+09:00","datePublished":"2022-01-18T12:33:00+09:00","description":"테스트 코드 작성해보기","headline":"리액트에서 비즈니스 로직을 나눠보자[2 - Hooks 를 테스트 해보자]","mainEntityOfPage":{"@type":"WebPage","@id":"https://sanghunlee-711.github.io//posts/refactoring-2/"},"url":"https://sanghunlee-711.github.io//posts/refactoring-2/"}</script><title>리액트에서 비즈니스 로직을 나눠보자[2 - Hooks 를 테스트 해보자] | Sanghun Lee</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Sanghun Lee"><meta name="application-name" content="Sanghun Lee"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end" lang="en"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="https://avatars.githubusercontent.com/u/57477415?s=400&u=0a5560e77df7918587791bf3e05ed7f74cc313eb&v=4" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Sanghun Lee</a></div><div class="site-subtitle font-italic">웹개발자 이상훈입니다.</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/resume/" class="nav-link"> <i class="fa-fw fas fa-file ml-xl-3 mr-xl-3 unloaded"></i> <span>RESUME</span> </a><li class="nav-item"> <a href="/portfolio/" class="nav-link"> <i class="fa-fw fas fa-newspaper ml-xl-3 mr-xl-3 unloaded"></i> <span>PORTFOLIO</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center"> <a href="https://github.com/sanghunlee-711" aria-label="github" class="order-3" target="_blank" rel="noopener"> <i class="fab fa-github-alt"></i> </a> <a href="https://twitter.com/twitter_username" aria-label="twitter" class="order-4" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['cloudlee','gmail.com'].join('@')" aria-label="email" class="order-5" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" class="order-6" > <i class="fas fa-rss"></i> </a> <span class="icon-border order-2"></span> <span id="mode-toggle-wrapper" class="order-1"> <i class="mode-toggle fas fa-adjust"></i> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } var self = this; /* always follow the system prefers */ this.sysDarkPrefers.addListener(function() { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.updateMermaid(); }); } /* constructor() */ setDark() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_KEY); sessionStorage.removeItem(ModeToggle.MODE_KEY); } get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode == ModeToggle.DARK_MODE; } get isLightMode() { return this.mode == ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer) ) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } updateMermaid() { if (typeof mermaid !== "undefined") { let expectedTheme = (this.modeStatus === ModeToggle.DARK_MODE? "dark" : "default"); let config = { theme: expectedTheme }; /* re-render the SVG › <https://github.com/mermaid-js/mermaid/issues/311#issuecomment-332557344> */ $(".mermaid").each(function() { let svgCode = $(this).prev().children().html(); $(this).removeAttr("data-processed"); $(this).html(svgCode); }); mermaid.initialize(config); mermaid.init(undefined, ".mermaid"); } } flipMode() { if (this.hasMode) { if (this.isSysDarkPrefer) { if (this.isLightMode) { this.clearMode(); } else { this.setLight(); } } else { if (this.isDarkMode) { this.clearMode(); } else { this.setDark(); } } } else { if (this.isSysDarkPrefer) { this.setLight(); } else { this.setDark(); } } this.updateMermaid(); } /* flipMode() */ } /* ModeToggle */ let toggle = new ModeToggle(); $(".mode-toggle").click(function() { toggle.flipMode(); }); </script> </span></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>리액트에서 비즈니스 로직을 나눠보자[2 - Hooks 를 테스트 해보자]</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>리액트에서 비즈니스 로직을 나눠보자[2 - Hooks 를 테스트 해보자]</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="semi-bold"> Sanghun lee </span> on <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Tue, Jan 18, 2022, 12:33 PM +0900" >Jan 18<i class="unloaded">2022-01-18T12:33:00+09:00</i> </span></div><div> <span> Updated <span class="timeago lastmod" data-toggle="tooltip" data-placement="bottom" title="Tue, Jan 18, 2022, 10:57 PM +0900" >Jan 18<i class="unloaded">2022-01-18T22:57:40+09:00</i> </span> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1245 words">6 min read</span></div></div><div class="post-content"> <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 850 585'%3E%3C/svg%3E" data-proofer-ignore data-src="https://layer.team/wp-content/uploads/2020/04/layer-app-spot-26-best-field-data-software-revit-addin-manage.png" class="preview-img" alt="Preview Image" width="850" height="585"><h1 id="테스트-코드-작성해보기">테스트 코드 작성해보기</h1><p>이제 비즈니스로직을 모두 나누었으니 해당 비즈니스 로직에 대해서만 테스트를 진행해보자</p><p>여러 테크기업들의 블로그를 뒤적이다. <a href="https://ridicorp.com/story/how-to-use-redux-in-ridi/">리디의 블로그</a>글을 가장 많이 참고하였다.</p><p>그리하여 redux-mockstore와 testing-library/react-hooks 를 이용하여 테스트를 진행했다.</p><p>우선 간단한 설명은 아래와 같다.</p><ol><li><code class="language-plaintext highlighter-rouge">mock-store</code>를 통해 실제 액션을 리듀서까지 전달하여 업데이트하는 것이 아닌 어떤 액션이 dispatching되는지 확인한다.<li><code class="language-plaintext highlighter-rouge">hooks</code> <code class="language-plaintext highlighter-rouge">mocking render</code> 하여 필요한 메서드들을 빼와서 act 시킨 다음의 호출되는 액션을 mocking store를 통해 확인한다.<li>localState의 경우 jest mock fn을 통해 처리한다.</ol><h1 id="business-logic">Business Logic</h1><p>1편에서 보았던 비즈니스 로직은 아래와 같고 <code class="language-plaintext highlighter-rouge">onApply</code> 테스트해보자.</p><div lang="ts" class="language-ts highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
</pre><td class="rouge-code"><pre><span class="kd">const</span> <span class="nx">usePersonnelManagementComponents</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">history</span> <span class="o">=</span> <span class="nx">useHistory</span><span class="p">();</span>
  <span class="kd">const</span> <span class="nx">dispatch</span> <span class="o">=</span> <span class="nx">useDispatch</span><span class="p">();</span>
  <span class="kd">const</span> <span class="p">{</span> <span class="nx">authPhase</span><span class="p">,</span> <span class="nx">mainPopup</span><span class="p">,</span> <span class="nx">companyInfoData</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">useRootState</span><span class="p">(</span>
    <span class="p">(</span><span class="nx">state</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">state</span><span class="p">.</span><span class="nb">global</span>
  <span class="p">);</span>
  <span class="kd">const</span> <span class="nx">storageToken</span> <span class="o">=</span> <span class="nx">localStorage</span><span class="p">.</span><span class="nx">getItem</span><span class="p">(</span><span class="dl">'</span><span class="s1">access_token</span><span class="dl">'</span><span class="p">);</span>


  <span class="kd">const</span> <span class="p">{</span>
    <span class="na">address</span><span class="p">:</span> <span class="nx">addressPopup</span><span class="p">,</span>
    <span class="na">certificate</span><span class="p">:</span> <span class="nx">certificatePopup</span><span class="p">,</span>
    <span class="nx">personnelManagement</span><span class="p">,</span>
  <span class="p">}</span> <span class="o">=</span> <span class="nx">MAIN_POPUP</span><span class="p">;</span>
  <span class="kd">const</span> <span class="p">{</span> <span class="nx">basicInfoTitle</span><span class="p">,</span> <span class="nx">check</span><span class="p">,</span> <span class="nx">origin</span><span class="p">,</span> <span class="nx">path</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">personnelManagement</span><span class="p">;</span>

  <span class="kd">const</span> <span class="nx">onApply</span> <span class="o">=</span> <span class="p">(</span><span class="na">phase</span><span class="p">:</span><span class="nx">phaseType</span><span class="p">,</span> <span class="na">token</span><span class="p">:</span><span class="kr">string</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">phase</span> <span class="o">===</span> <span class="dl">'</span><span class="s1">logout</span><span class="dl">'</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">token</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">dispatch</span><span class="p">(</span><span class="nx">setIsLoginModalVisible</span><span class="p">(</span><span class="kc">true</span><span class="p">));</span>
    <span class="p">}</span>

  <span class="c1">//When Logged In</span>
    <span class="nx">dispatch</span><span class="p">(</span>
      <span class="nx">checkBasicCompanyInfoAction</span><span class="p">({</span>
        <span class="na">check</span><span class="p">:</span> <span class="nx">check</span> <span class="k">as</span> <span class="p">(</span><span class="kr">keyof</span> <span class="nx">ICompanyInfo</span><span class="p">)[],</span>
        <span class="na">domain</span><span class="p">:</span> <span class="nx">origin</span><span class="p">,</span>
        <span class="nx">path</span><span class="p">,</span>
      <span class="p">}),</span>
    <span class="p">);</span>
  <span class="p">};</span>

  <span class="nx">useEffect</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">localStorage</span><span class="p">.</span><span class="nx">getItem</span><span class="p">(</span><span class="dl">'</span><span class="s1">isPaused</span><span class="dl">'</span><span class="p">)</span> <span class="o">===</span> <span class="dl">'</span><span class="s1">true</span><span class="dl">'</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">localStorage</span><span class="p">.</span><span class="nx">removeItem</span><span class="p">(</span><span class="dl">'</span><span class="s1">isPaused</span><span class="dl">'</span><span class="p">);</span>
      <span class="nx">actions</span><span class="p">.</span><span class="nx">onApply</span><span class="p">();</span>
    <span class="p">}</span>
  <span class="p">},</span> <span class="p">[]);</span>

  <span class="k">return</span> <span class="p">{</span>
    <span class="na">state</span><span class="p">:</span> <span class="p">{</span>
      <span class="nx">mainPopup</span><span class="p">,</span>
      <span class="nx">storageToken</span><span class="p">,</span>
      <span class="p">...</span>
    <span class="p">},</span>
    <span class="na">actions</span><span class="p">:</span> <span class="p">{</span>
      <span class="nx">onApply</span><span class="p">,</span>
      <span class="p">...</span>
    <span class="p">},</span>
  <span class="p">};</span>
<span class="p">};</span>

<span class="k">export</span> <span class="k">default</span> <span class="nx">usePersonnelManagementComponents</span><span class="p">;</span>
</pre></table></code></div></div><p>onApply의 구조는 간단한데 들어온 인자들에 대해서 특정조건에 따라 dispatching하는 액션이 달라지게 된다.</p><p>그래서 두가지 케이스에서 테스트를 진행할 수 있게 되고 아래와 같이 진행했다.</p><div lang="tsx" class="language-tsx highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
</pre><td class="rouge-code"><pre><span class="nx">describe</span><span class="p">(</span><span class="dl">"</span><span class="s2">usePersonnel</span><span class="dl">"</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">setup</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">store</span> <span class="o">=</span> <span class="nx">createMockStore</span><span class="p">();</span>

    <span class="kd">const</span> <span class="p">{</span> <span class="nx">result</span><span class="p">,</span> <span class="nx">waitForNextUpdate</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">renderHook</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="nx">usePersonnel</span><span class="p">(),</span> <span class="p">{</span>
      <span class="na">wrapper</span><span class="p">:</span> <span class="p">({</span> <span class="nx">children</span> <span class="p">}:</span> <span class="p">{</span> <span class="na">children</span><span class="p">:</span> <span class="nx">React</span><span class="p">.</span><span class="nx">ReactNode</span> <span class="p">})</span> <span class="o">=&gt;</span> <span class="p">(</span>
        <span class="p">&lt;</span><span class="nc">Provider</span> <span class="na">store</span><span class="p">=</span><span class="si">{</span><span class="nx">store</span><span class="si">}</span><span class="p">&gt;</span><span class="si">{</span><span class="nx">children</span><span class="si">}</span><span class="p">&lt;/</span><span class="nc">Provider</span><span class="p">&gt;</span>
      <span class="p">),</span>
    <span class="p">});</span>

    <span class="k">return</span> <span class="p">{</span> <span class="nx">store</span><span class="p">,</span> <span class="nx">result</span><span class="p">,</span> <span class="nx">waitForNextUpdate</span> <span class="p">};</span>
  <span class="p">};</span>

  <span class="nx">describe</span><span class="p">(</span><span class="dl">"</span><span class="s2">onApply</span><span class="dl">"</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">it</span><span class="p">(</span><span class="dl">"</span><span class="s2">토큰이 존재하고 phase가 logout인 경우 로그아웃 요청을 위한 action 호출</span><span class="dl">"</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="kd">const</span> <span class="p">{</span> <span class="nx">result</span><span class="p">,</span> <span class="nx">store</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">setup</span><span class="p">();</span>
      <span class="kd">const</span> <span class="nx">MOCK_PHASE</span> <span class="o">=</span> <span class="nx">phaseType</span><span class="p">.</span><span class="nx">logout</span><span class="p">;</span> <span class="c1">//enum</span>
      <span class="kd">const</span> <span class="nx">MOCK_TOKEN</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">MOCK_TOKEN</span><span class="dl">"</span><span class="p">;</span>
      <span class="nx">act</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="nx">result</span><span class="p">.</span><span class="nx">current</span><span class="p">.</span><span class="nx">actions</span><span class="p">.</span><span class="nx">onApply</span><span class="p">(</span><span class="nx">MOCK_PHASE</span><span class="p">,</span> <span class="nx">MOCK_TOKEN</span><span class="p">);</span>
      <span class="p">});</span>

      <span class="nx">expect</span><span class="p">(</span><span class="nx">store</span><span class="p">.</span><span class="nx">getActions</span><span class="p">()).</span><span class="nx">toEqual</span><span class="p">([</span><span class="nx">setIsLoginModalVisible</span><span class="p">(</span><span class="kc">true</span><span class="p">)]);</span>
    <span class="p">});</span>
  <span class="p">});</span>
<span class="p">});</span>
</pre></table></code></div></div><ul><li>위와 같은 방식으로 해당 hooks를 라이브러리에 존재하는 renderHook 메서드를 활용해서 불러주고 mockStore를 만들어 action을 가져올 수 있게 하였다.<li>그리고 렌더 후 필요한 actions와 state를 가져오기 위해 <code class="language-plaintext highlighter-rouge">setup()</code> 메서드를 호출해와서 필요한 액션을 불러오고 그 결과에 알맞는 결과값이 도출되는지 확인한다.</ul><p>위 예시로는 굉장히 간단해보이지만 만약 조건이 많고 복잡한 로직이 컴포넌트 내부에 내재되어있는 상황이라면 충분히 유용하게 이러한 hooks를 통한 테스트를 활용할 수 있을 것 같다.</p><p>하지만 해당테스트 샘플을 자세히 보면 문제가 있다고 생각이 들 것이다.</p><p>장단점을 나열하며 생각해보자.</p><h3 id="장점과-단점">장점과 단점</h3><ul><li><p>장점</p><ul><li>간단한 비즈니스로직이라도 휴먼에러는 언제나 존재하니 이런식으로 재빠르게 테스트를 진행하고 개발을 한다면 안정성이 증가 될 것 같다.<li>분리를 하면 할 수록 내 코드가 얼마나 난장판인지 알 수 있게 된다.<li>사이드이펙트를 의도적으로 줄이고 순수함수를 지향하게 된다.<ul><li>hooks를 통한 테스트에서는 내부 state를 변경하는 바보같은 짓(계속 시도했었음 ㅎㅅㅎ..)을 하기 위한 것이 아닌 해당 메서드가 요청하는 인자를 넘겼을 때 원하는 값이 나오도록 하는것을 보장하는것이 주된 목적이다.<li>그래서 함수의 <code class="language-plaintext highlighter-rouge">side effect를 발생시키기 위해 인자에 넣지 않고(리팩토링의 시간)</code> 곧바로 함수에서 state를 참조해서 변경해주는 것을 <code class="language-plaintext highlighter-rouge">지양</code>하게 된다.<li><strong><em>위의 onApply도 check, origin, path를 인자로 받는 것이 제대로된 테스트가 되겠다.</em></strong></ul></ul><li><p>단점</p><ul><li>파일의 수와 테스트코드의 수가 늘어나게 된다.<ul><li>불필요하다고 판단되는 로직마저 아무생각없이 테스트하고 있는 자신을 발견한다.</ul><li>리팩토링 시 파일 열기가 귀찮다<li>사실 단점은 거의 없는 것 같다.</ul></ul><p>끝!</p><h2 id="참고">참고</h2><ul><li><a href="https://medium.com/dailyjs/how-to-create-a-three-layer-application-with-react-hooks-2efba9ba345f">How to Create a Three-Layer Application with React Hooks</a><li><a href="https://ridicorp.com/story/how-to-use-redux-in-ridi/">RIDI-리덕스 잘 쓰고 계시나요?</a><li><a href="https://github.com/testing-library/react-hooks-testing-library">testing-library / react-hooks-testing-library</a><li><a href="https://www.npmjs.com/package/redux-mock-store">npm-redux-mock-store</a></ul></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/fe/'>FE</a>, <a href='/categories/react/'>React</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/architecture/" class="post-tag no-text-decoration" >Architecture</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=리액트에서 비즈니스 로직을 나눠보자[2 - Hooks 를 테스트 해보자] - Sanghun Lee&url=https://sanghunlee-711.github.io//posts/refactoring-2/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=리액트에서 비즈니스 로직을 나눠보자[2 - Hooks 를 테스트 해보자] - Sanghun Lee&u=https://sanghunlee-711.github.io//posts/refactoring-2/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=리액트에서 비즈니스 로직을 나눠보자[2 - Hooks 를 테스트 해보자] - Sanghun Lee&url=https://sanghunlee-711.github.io//posts/refactoring-2/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink('', 'Link copied successfully!')" data-toggle="tooltip" data-placement="top" title="Copy link"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"> <span>Recent Update</span><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/refactoring-2/">리액트에서 비즈니스 로직을 나눠보자[2 - Hooks 를 테스트 해보자]</a><li><a href="/posts/refactoring-1/">리액트에서 비즈니스 로직을 나눠보자[1 - 비즈니스로직 분리]</a><li><a href="/posts/webpack2/">Webpack과 React를 사용하여 Custome Element 만들기[2 - 웹팩(플러그인)]</a><li><a href="/posts/webpack3/">Webpack과 React를 사용하여 Custome Element 만들기[3 - 커스텀엘리먼트 렌더]</a><li><a href="/posts/nextjs_basic/">Next JS를 공부해보자[1편]</a></ul></div><div id="access-tags"> <span>Trending Tags</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/architecture/">Architecture</a> <a class="post-tag" href="/tags/webpack/">Webpack</a> <a class="post-tag" href="/tags/next-js/">Next JS</a> <a class="post-tag" href="/tags/algorithm/">Algorithm</a> <a class="post-tag" href="/tags/cors/">Cors</a> <a class="post-tag" href="/tags/cypress/">Cypress</a> <a class="post-tag" href="/tags/fe-test/">FE Test</a> <a class="post-tag" href="/tags/jest/">Jest</a> <a class="post-tag" href="/tags/msw/">msw</a> <a class="post-tag" href="/tags/prefilght/">Prefilght</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/refactoring-1/"><div class="card-body"> <span class="timeago small" >Dec 15, 2021<i class="unloaded">2021-12-15T12:33:00+09:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>리액트에서 비즈니스 로직을 나눠보자[1 - 비즈니스로직 분리]</h3><div class="text-muted small"><p> 왜 하게 되었냐면 회사에서 개발자 다수가 이탈하게 되면서 빠른 유지보수와 코드의 정확성을 높이는 일이 나에게도, 회사에게도 중요해졌다. 현재 리액트 프로젝트에서 Toolkit과 Saga를 통해서 나름 나눈다고 나눴지만 이 과정에서 불필요한 코드들도 많아졌고, 실제로 state나 hooks와 연결된 부분은 컴포넌트에 그대로 남아있게 되었다. 그래서...</p></div></div></a></div><div class="card"> <a href="/posts/refactoring-3/"><div class="card-body"> <span class="timeago small" >May 12<i class="unloaded">2022-05-12T12:33:00+09:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>리액트에서 비즈니스 로직을 나눠보자[3 - ContextAPI마저 활용해보자]</h3><div class="text-muted small"><p> Props Drilling을 피해보기 2편의 hooks의 방식으로 state(상태)를 로컬에서 계속 가져가기를 바라면 대부분 페이지의 최상단에서 하단의 매칭된 컴포넌트까지 Props Drilling이 생기게 된다. 아래 예제를 한번 봐보자. 무엇이 문제였는가? 일단 공용으로 사용되는 컴포넌트를 한번 봐보자. 아래는 기간을 정할 수 있기 위해 ...</p></div></div></a></div><div class="card"> <a href="/posts/webpack2/"><div class="card-body"> <span class="timeago small" >Sep 18, 2021<i class="unloaded">2021-09-18T12:33:00+09:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Webpack과 React를 사용하여 Custome Element 만들기[2 - 웹팩(플러그인)]</h3><div class="text-muted small"><p> Webpack 1. 사용한 플러그인(plugins) 플러그인은 번들된 파일을 처리하기 위해 사용하는 것이다. 각 플러그인의 개념은 간단하게 적고 넘어가겠다. 1.1 CleanWebpackPlugin 이 플러그인은 출력 Path(output)으로 정해놓은 것의 모든파일을 지워주고 리빌드 완료 후 사용되지않는 이미지 파일등의 webpack asse...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/refactoring-1/" class="btn btn-outline-primary" prompt="Older"><p>리액트에서 비즈니스 로직을 나눠보자[1 - 비즈니스로직 분리]</p></a> <a href="/posts/refactoring-3/" class="btn btn-outline-primary" prompt="Newer"><p>리액트에서 비즈니스 로직을 나눠보자[3 - ContextAPI마저 활용해보자]</p></a></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2022 <a href="https://github.com/sanghunlee-711">Sanghun lee</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/architecture/">Architecture</a> <a class="post-tag" href="/tags/webpack/">Webpack</a> <a class="post-tag" href="/tags/next-js/">Next JS</a> <a class="post-tag" href="/tags/algorithm/">Algorithm</a> <a class="post-tag" href="/tags/cors/">Cors</a> <a class="post-tag" href="/tags/cypress/">Cypress</a> <a class="post-tag" href="/tags/fe-test/">FE Test</a> <a class="post-tag" href="/tags/jest/">Jest</a> <a class="post-tag" href="/tags/msw/">msw</a> <a class="post-tag" href="/tags/prefilght/">Prefilght</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><script src="https://cdn.jsdelivr.net/npm/mermaid@8/dist/mermaid.min.js"></script> <script> $(function() { let initTheme = "default"; if ($("html[mode=dark]").length > 0 || ($("html[mode]").length == 0 && window.matchMedia("(prefers-color-scheme: dark)").matches ) ) { initTheme = "dark"; } let mermaidConf = { theme: initTheme /* <default|dark|forest|neutral> */ }; /* Markdown converts to HTML */ $("pre").has("code.language-mermaid").each(function() { let svgCode = $(this).children().html(); $(this).addClass("unloaded"); $(this).after(`<div class=\"mermaid\">${svgCode}</div>`); }); mermaid.initialize(mermaidConf); }); </script><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://sanghunlee-711.github.io/{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script> /* see: <https://docs.mathjax.org/en/latest/options/input/tex.html#tex-options> */ MathJax = { tex: { inlineMath: [ /* start/end delimiter pairs for in-line math */ ['$','$'], ['\\(','\\)'] ], displayMath: [ /* start/end delimiter pairs for display math */ ['$$', '$$'], ['\\[', '\\]'] ] } }; </script> <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script type="text/javascript" id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"> </script> <script src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.16.1,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id="></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', ''); }); </script>
