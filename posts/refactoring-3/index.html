<!DOCTYPE html><html lang="ko" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="day-prompt" content="days ago"><meta name="hour-prompt" content="hours ago"><meta name="minute-prompt" content="minutes ago"><meta name="justnow-prompt" content="just now"><meta name="generator" content="Jekyll v4.2.2" /><meta property="og:title" content="리액트에서 비즈니스 로직을 나눠보자[3 - ContextAPI마저 활용해보자]" /><meta name="author" content="Sanghun lee" /><meta property="og:locale" content="ko" /><meta name="description" content="Props Drilling을 피해보기" /><meta property="og:description" content="Props Drilling을 피해보기" /><link rel="canonical" href="https://sanghunlee-711.github.io//posts/refactoring-3/" /><meta property="og:url" content="https://sanghunlee-711.github.io//posts/refactoring-3/" /><meta property="og:site_name" content="Sanghun Lee" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2022-05-12T12:33:00+09:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="리액트에서 비즈니스 로직을 나눠보자[3 - ContextAPI마저 활용해보자]" /><meta name="twitter:site" content="@twitter_username" /><meta name="twitter:creator" content="@Sanghun lee" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Sanghun lee"},"dateModified":"2022-05-12T12:33:00+09:00","datePublished":"2022-05-12T12:33:00+09:00","description":"Props Drilling을 피해보기","headline":"리액트에서 비즈니스 로직을 나눠보자[3 - ContextAPI마저 활용해보자]","mainEntityOfPage":{"@type":"WebPage","@id":"https://sanghunlee-711.github.io//posts/refactoring-3/"},"url":"https://sanghunlee-711.github.io//posts/refactoring-3/"}</script><title>리액트에서 비즈니스 로직을 나눠보자[3 - ContextAPI마저 활용해보자] | Sanghun Lee</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Sanghun Lee"><meta name="application-name" content="Sanghun Lee"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end" lang="en"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="https://avatars.githubusercontent.com/u/57477415?s=400&u=0a5560e77df7918587791bf3e05ed7f74cc313eb&v=4" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Sanghun Lee</a></div><div class="site-subtitle font-italic">웹개발자 이상훈입니다.</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/resume/" class="nav-link"> <i class="fa-fw fas fa-file ml-xl-3 mr-xl-3 unloaded"></i> <span>RESUME</span> </a><li class="nav-item"> <a href="/portfolio/" class="nav-link"> <i class="fa-fw fas fa-newspaper ml-xl-3 mr-xl-3 unloaded"></i> <span>PORTFOLIO</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center"> <a href="https://github.com/sanghunlee-711" aria-label="github" class="order-3" target="_blank" rel="noopener"> <i class="fab fa-github-alt"></i> </a> <a href="https://twitter.com/twitter_username" aria-label="twitter" class="order-4" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['cloudlee','gmail.com'].join('@')" aria-label="email" class="order-5" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" class="order-6" > <i class="fas fa-rss"></i> </a> <span class="icon-border order-2"></span> <span id="mode-toggle-wrapper" class="order-1"> <i class="mode-toggle fas fa-adjust"></i> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } var self = this; /* always follow the system prefers */ this.sysDarkPrefers.addListener(function() { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.updateMermaid(); }); } /* constructor() */ setDark() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_KEY); sessionStorage.removeItem(ModeToggle.MODE_KEY); } get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode == ModeToggle.DARK_MODE; } get isLightMode() { return this.mode == ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer) ) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } updateMermaid() { if (typeof mermaid !== "undefined") { let expectedTheme = (this.modeStatus === ModeToggle.DARK_MODE? "dark" : "default"); let config = { theme: expectedTheme }; /* re-render the SVG › <https://github.com/mermaid-js/mermaid/issues/311#issuecomment-332557344> */ $(".mermaid").each(function() { let svgCode = $(this).prev().children().html(); $(this).removeAttr("data-processed"); $(this).html(svgCode); }); mermaid.initialize(config); mermaid.init(undefined, ".mermaid"); } } flipMode() { if (this.hasMode) { if (this.isSysDarkPrefer) { if (this.isLightMode) { this.clearMode(); } else { this.setLight(); } } else { if (this.isDarkMode) { this.clearMode(); } else { this.setDark(); } } } else { if (this.isSysDarkPrefer) { this.setLight(); } else { this.setDark(); } } this.updateMermaid(); } /* flipMode() */ } /* ModeToggle */ let toggle = new ModeToggle(); $(".mode-toggle").click(function() { toggle.flipMode(); }); </script> </span></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>리액트에서 비즈니스 로직을 나눠보자[3 - ContextAPI마저 활용해보자]</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>리액트에서 비즈니스 로직을 나눠보자[3 - ContextAPI마저 활용해보자]</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="semi-bold"> Sanghun lee </span> on <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Thu, May 12, 2022, 12:33 PM +0900" >May 12<i class="unloaded">2022-05-12T12:33:00+09:00</i> </span></div><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="3915 words">21 min read</span></div></div><div class="post-content"> <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 850 585'%3E%3C/svg%3E" data-proofer-ignore data-src="https://layer.team/wp-content/uploads/2020/04/layer-app-spot-26-best-field-data-software-revit-addin-manage.png" class="preview-img" alt="Preview Image" width="850" height="585"><h1 id="props-drilling을-피해보기">Props Drilling을 피해보기</h1><p>2편의 hooks의 방식으로 state(상태)를 로컬에서 계속 가져가기를 바라면 대부분 페이지의 최상단에서 하단의 매칭된 컴포넌트까지 Props Drilling이 생기게 된다.</p><p>아래 예제를 한번 봐보자.</p><h1 id="무엇이-문제였는가">무엇이 문제였는가?</h1><p>일단 공용으로 사용되는 컴포넌트를 한번 봐보자.</p><p>아래는 기간을 정할 수 있기 위해 사용하는 컴포넌트로 날짜와 시간을 정할 수 있는 컴포넌트이다.</p><div lang="tsx" class="language-tsx highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
</pre><td class="rouge-code"><pre><span class="kr">interface</span> <span class="nx">IPeriodSelectorProps</span> <span class="p">{</span>
  <span class="nl">withTimes</span><span class="p">:</span> <span class="nx">boolean</span><span class="p">;</span>
  <span class="nl">labelText</span><span class="p">?:</span> <span class="kr">string</span><span class="p">;</span>
  <span class="nl">date</span><span class="p">:</span> <span class="p">[</span><span class="nb">Date</span><span class="p">,</span> <span class="nb">Date</span><span class="p">];</span>
  <span class="nl">selectTime</span><span class="p">:</span> <span class="kr">string</span><span class="p">[];</span>
  <span class="nl">handleStartDate</span><span class="p">:</span> <span class="p">(</span><span class="nx">date</span><span class="p">:</span> <span class="nb">Date</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="k">void</span><span class="p">;</span>
  <span class="nl">handleEndDate</span><span class="p">:</span> <span class="p">(</span><span class="nx">date</span><span class="p">:</span> <span class="nb">Date</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="k">void</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">const</span> <span class="nx">PeriodSelector</span><span class="p">:</span> <span class="nx">React</span><span class="p">.</span><span class="nx">FC</span><span class="o">&lt;</span><span class="nx">IPeriodSelectorProps</span><span class="o">&gt;</span> <span class="o">=</span> <span class="p">({</span>
  <span class="nx">withTimes</span><span class="p">,</span>
  <span class="nx">labelText</span><span class="p">,</span>
  <span class="nx">date</span><span class="p">,</span>
  <span class="nx">selectTime</span><span class="p">,</span>
  <span class="nx">handleStartDate</span><span class="p">,</span>
  <span class="nx">handleEndDate</span><span class="p">,</span>
<span class="p">}):</span> <span class="nx">JSX</span><span class="p">.</span><span class="nx">Element</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">return</span> <span class="p">(</span>
    <span class="p">&lt;</span><span class="nc">WrapperDate</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">span</span><span class="p">&gt;</span><span class="si">{</span><span class="nx">labelText</span> <span class="o">||</span> <span class="dl">"</span><span class="s2">기간 선택</span><span class="dl">"</span><span class="si">}</span><span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
          <span class="p">&lt;</span><span class="nc">Calendar</span>
            <span class="na">date</span><span class="p">=</span><span class="si">{</span><span class="nx">date</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">||</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">()</span><span class="si">}</span>
            <span class="na">handleDate</span><span class="p">=</span><span class="si">{</span><span class="nx">handleStartDate</span> <span class="o">||</span> <span class="p">(()</span> <span class="o">=&gt;</span> <span class="kc">null</span><span class="p">)</span><span class="si">}</span>
          <span class="p">/&gt;</span>
          <span class="si">{</span><span class="nx">withTimes</span> <span class="o">&amp;&amp;</span> <span class="nx">handleTime</span> <span class="o">&amp;&amp;</span> <span class="nx">selectTime</span> <span class="o">&amp;&amp;</span> <span class="p">(</span>
            <span class="p">&lt;</span><span class="nt">input</span>
              <span class="na">type</span><span class="p">=</span><span class="s">"time"</span>
              <span class="na">value</span><span class="p">=</span><span class="si">{</span><span class="nx">selectTime</span> <span class="o">&amp;&amp;</span> <span class="nx">selectTime</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span>
              <span class="na">name</span><span class="p">=</span><span class="s">"startTime"</span>
              <span class="na">onChange</span><span class="p">=</span><span class="si">{</span><span class="nx">handleTime</span><span class="si">}</span>
            <span class="p">/&gt;</span>
          <span class="p">)</span><span class="si">}</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">span</span><span class="p">&gt;</span>~<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
          <span class="p">&lt;</span><span class="nc">Calendar</span>
            <span class="na">date</span><span class="p">=</span><span class="si">{</span><span class="nx">date</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">||</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">()</span><span class="si">}</span>
            <span class="na">handleDate</span><span class="p">=</span><span class="si">{</span><span class="nx">handleEndDate</span> <span class="o">||</span> <span class="p">(()</span> <span class="o">=&gt;</span> <span class="kc">null</span><span class="p">)</span><span class="si">}</span>
          <span class="p">/&gt;</span>
          <span class="si">{</span><span class="nx">withTimes</span> <span class="o">&amp;&amp;</span> <span class="nx">handleTime</span> <span class="o">&amp;&amp;</span> <span class="nx">selectTime</span> <span class="o">&amp;&amp;</span> <span class="p">(</span>
            <span class="p">&lt;</span><span class="nt">input</span>
              <span class="na">type</span><span class="p">=</span><span class="s">"time"</span>
              <span class="na">value</span><span class="p">=</span><span class="si">{</span><span class="nx">selectTime</span> <span class="o">&amp;&amp;</span> <span class="nx">selectTime</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span>
              <span class="na">name</span><span class="p">=</span><span class="s">"endTime"</span>
              <span class="na">onChange</span><span class="p">=</span><span class="si">{</span><span class="nx">handleTime</span><span class="si">}</span>
            <span class="p">/&gt;</span>
          <span class="p">)</span><span class="si">}</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
      <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nc">WrapperDate</span><span class="p">&gt;</span>
  <span class="p">);</span>
<span class="p">};</span>

<span class="kd">const</span> <span class="nx">areEqual</span> <span class="o">=</span> <span class="p">(</span>
  <span class="nx">prevProps</span><span class="p">:</span> <span class="nb">Readonly</span><span class="o">&lt;</span><span class="nx">PropsWithChildren</span><span class="o">&lt;</span><span class="nx">IPeriodSelectorProps</span><span class="o">&gt;&gt;</span><span class="p">,</span>
  <span class="nx">nextProps</span><span class="p">:</span> <span class="nb">Readonly</span><span class="o">&lt;</span><span class="nx">PropsWithChildren</span><span class="o">&lt;</span><span class="nx">IPeriodSelectorProps</span><span class="o">&gt;&gt;</span>
<span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">return</span> <span class="p">(</span>
    <span class="nx">prevProps</span><span class="p">.</span><span class="nx">date</span> <span class="o">===</span> <span class="nx">nextProps</span><span class="p">.</span><span class="nx">date</span> <span class="o">||</span>
    <span class="nx">prevProps</span><span class="p">.</span><span class="nx">selectTime</span> <span class="o">===</span> <span class="nx">nextProps</span><span class="p">.</span><span class="nx">selectTime</span> <span class="o">||</span>
    <span class="nx">prevProps</span><span class="p">.</span><span class="nx">labelText</span> <span class="o">===</span> <span class="nx">nextProps</span><span class="p">.</span><span class="nx">labelText</span>
  <span class="p">);</span>
<span class="p">};</span>

<span class="k">export</span> <span class="k">default</span> <span class="nx">React</span><span class="p">.</span><span class="nx">memo</span><span class="p">(</span><span class="nx">PeriodSelector</span><span class="p">,</span> <span class="nx">areEqual</span><span class="p">);</span>
</pre></table></code></div></div><p>그래도 렌더링 최적화를 애쓰려고 memoizing을 해놓은것이 참..</p><p>일단 해당컴포넌트만을 바라보았을때는 Props 개수가 다소 많지만 그래도 용인할 수 있는 수준인 것 같다고 생각하며</p><p>개발을 계속 진행할 수 있다.</p><p>하지만 이 컴포넌트를 사용하는 입장의 각 페이지별 index페이지를 보면 이야기가 달라진다.</p><div lang="tsx" class="language-tsx highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
</pre><td class="rouge-code"><pre><span class="p">...</span><span class="nx">생략</span>
<span class="k">import</span> <span class="nx">usePeriodSelector</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">hooks/usePeriodSelector</span><span class="dl">'</span><span class="p">;</span>
<span class="p">...</span><span class="nx">생략</span>

<span class="k">export</span> <span class="kd">const</span> <span class="nx">BannerList</span><span class="p">:</span> <span class="nx">React</span><span class="p">.</span><span class="nx">FC</span> <span class="o">=</span> <span class="p">():</span> <span class="nx">JSX</span><span class="p">.</span><span class="nx">Element</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="p">...</span><span class="nx">생략</span>

  <span class="kd">const</span> <span class="p">{</span>
    <span class="na">state</span><span class="p">:</span> <span class="p">{</span> <span class="nx">date</span> <span class="p">},</span>
    <span class="na">actions</span><span class="p">:</span> <span class="p">{</span> <span class="nx">handleEndDate</span><span class="p">,</span> <span class="nx">handleStartDate</span><span class="p">,</span> <span class="nx">initializeDate</span> <span class="p">},</span>
  <span class="p">}</span> <span class="o">=</span> <span class="nx">usePeriodSelector</span><span class="p">();</span>

  <span class="p">...</span><span class="nx">생략</span>

  <span class="k">return</span> <span class="p">(</span>
    <span class="p">&lt;&gt;</span>
      <span class="p">&lt;</span><span class="nc">BannerListPageSelectors</span>
        <span class="na">checkArr</span><span class="p">=</span><span class="si">{</span><span class="nx">checkArr</span><span class="si">}</span>
        <span class="na">date</span><span class="p">=</span><span class="si">{</span><span class="nx">date</span><span class="si">}</span>
        <span class="na">title</span><span class="p">=</span><span class="si">{</span><span class="nx">title</span><span class="si">}</span>
        <span class="na">register</span><span class="p">=</span><span class="si">{</span><span class="nx">register</span><span class="si">}</span>
        <span class="na">bannerType</span><span class="p">=</span><span class="si">{</span><span class="nx">bannerType</span><span class="si">}</span>
        <span class="na">isSearching</span><span class="p">=</span><span class="si">{</span><span class="nx">isSearching</span><span class="si">}</span>
        <span class="na">onSearch</span><span class="p">=</span><span class="si">{</span><span class="nx">onSearch</span><span class="si">}</span>
        <span class="na">onCancelSearch</span><span class="p">=</span><span class="si">{</span><span class="nx">initializeSearchData</span><span class="si">}</span>
        <span class="na">handleStatus</span><span class="p">=</span><span class="si">{</span><span class="nx">handleStatus</span><span class="si">}</span>
        <span class="na">handleInput</span><span class="p">=</span><span class="si">{</span><span class="nx">handleInput</span><span class="si">}</span>
        <span class="na">handleSelect</span><span class="p">=</span><span class="si">{</span><span class="nx">handleSelect</span><span class="si">}</span>
        <span class="na">handleEndDate</span><span class="p">=</span><span class="si">{</span><span class="nx">handleEndDate</span><span class="si">}</span>
        <span class="na">handleStartDate</span><span class="p">=</span><span class="si">{</span><span class="nx">handleStartDate</span><span class="si">}</span>
      <span class="p">/&gt;</span>
      <span class="p">&lt;</span><span class="nc">BannerListTableList</span>
        <span class="na">data</span><span class="p">=</span><span class="si">{</span><span class="nx">listData</span> <span class="o">||</span> <span class="p">[]</span><span class="si">}</span>
        <span class="na">total</span><span class="p">=</span><span class="si">{</span><span class="nx">totalDataCount</span> <span class="o">||</span> <span class="mi">0</span><span class="si">}</span>
        <span class="na">doRefetch</span><span class="p">=</span><span class="si">{</span><span class="nx">doRefetch</span><span class="si">}</span>
      <span class="p">/&gt;</span>
    <span class="p">&lt;/&gt;</span>
  <span class="p">);</span>
<span class="p">};</span>

</pre></table></code></div></div><p>해당 코드는 배너목록을 보여주며 검색을 위한 검색창이 상단에 있고 아래는 테이블이 있는 UI를 가진 페이지의 index파일이다.</p><p>일부 코드만을 가져왔음에도 불구하고 <code class="language-plaintext highlighter-rouge">BannerListPageSelectors</code>컴포넌트의 Props갯수를 보면 숨이 막힌다.</p><p>그럼 <code class="language-plaintext highlighter-rouge">BannerListPageSelectors</code>의 코드를 보자.</p><div lang="tsx" class="language-tsx highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
</pre><td class="rouge-code"><pre><span class="p">...</span><span class="nx">생략</span>

<span class="kr">interface</span> <span class="nx">IBannerListPageSelectorsProps</span> <span class="p">{</span>
  <span class="p">...</span><span class="nx">생략</span>
  <span class="nx">date</span><span class="p">:</span> <span class="p">[</span><span class="nb">Date</span><span class="p">,</span> <span class="nb">Date</span><span class="p">];</span>
  <span class="nl">handleEndDate</span><span class="p">:</span> <span class="p">(</span><span class="nx">endDate</span><span class="p">:</span> <span class="nb">Date</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="k">void</span><span class="p">;</span>
  <span class="nl">handleStartDate</span><span class="p">:</span> <span class="p">(</span><span class="nx">startDate</span><span class="p">:</span> <span class="nb">Date</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="k">void</span><span class="p">;</span>
  <span class="p">...</span><span class="nx">생략</span>
<span class="p">}</span>

<span class="k">export</span> <span class="kd">const</span> <span class="nx">BannerListPageSelectors</span><span class="p">:</span> <span class="nx">React</span><span class="p">.</span><span class="nx">FC</span><span class="o">&lt;</span>
  <span class="nx">IBannerListPageSelectorsProps</span>
<span class="o">&gt;</span> <span class="o">=</span> <span class="p">({</span>
  <span class="p">...</span><span class="nx">생략</span>
  <span class="nx">date</span><span class="p">,</span>
  <span class="nx">handleEndDate</span><span class="p">,</span>
  <span class="nx">handleStartDate</span><span class="p">,</span>
  <span class="p">...</span><span class="nx">생략</span>
<span class="p">}):</span> <span class="nx">JSX</span><span class="p">.</span><span class="nx">Element</span> <span class="o">=&gt;</span> <span class="p">{</span>

  <span class="p">...</span><span class="nx">생략</span>
  <span class="p">...</span><span class="nx">생략</span>

  <span class="k">return</span> <span class="p">(</span>
    <span class="p">&lt;</span><span class="nc">BasicSelectorContainer</span>
      <span class="na">onSearch</span><span class="p">=</span><span class="si">{</span><span class="nx">onSearch</span><span class="si">}</span>
      <span class="na">isSearching</span><span class="p">=</span><span class="si">{</span><span class="nx">isSearching</span><span class="si">}</span>
      <span class="na">onCancelSearch</span><span class="p">=</span><span class="si">{</span><span class="nx">onCancelSearch</span><span class="si">}</span>
    <span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nc">PageSelectWrapper</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nc">DefaultPageSelect</span>
          <span class="na">label</span><span class="p">=</span><span class="s">"배너 유형"</span>
          <span class="na">selectOptions</span><span class="p">=</span><span class="si">{</span><span class="nx">bannerListData</span><span class="si">}</span>
          <span class="na">selectValue</span><span class="p">=</span><span class="si">{</span><span class="nx">bannerType</span><span class="p">.</span><span class="nx">value</span><span class="si">}</span>
          <span class="na">onSelect</span><span class="p">=</span><span class="si">{</span><span class="nx">handleSelect</span><span class="si">}</span>
          <span class="na">selectWidth</span><span class="p">=</span><span class="s">"470px"</span>
          <span class="na">selectHeight</span><span class="p">=</span><span class="s">"45px"</span>
          <span class="na">fontSize</span><span class="p">=</span><span class="s">"16px"</span>
          <span class="na">placeHolder</span><span class="p">=</span><span class="s">"배너 유형을 선택해주세요."</span>
          <span class="na">name</span><span class="p">=</span><span class="s">"bannerType"</span>
        <span class="p">/&gt;</span>
        <span class="p">&lt;</span><span class="nc">PeriodSelector</span>
          <span class="na">startDate</span><span class="p">=</span><span class="si">{</span><span class="nx">date</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span>
          <span class="na">endDate</span><span class="p">=</span><span class="si">{</span><span class="nx">date</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span>
          <span class="na">withTimes</span><span class="p">=</span><span class="si">{</span><span class="kc">false</span><span class="si">}</span>
          <span class="na">handleEndDate</span><span class="p">=</span><span class="si">{</span><span class="nx">handleEndDate</span><span class="si">}</span>
          <span class="na">handleStartDate</span><span class="p">=</span><span class="si">{</span><span class="nx">handleStartDate</span><span class="si">}</span>
        <span class="p">/&gt;</span>
        ...생략
      <span class="p">&lt;/</span><span class="nc">PageSelectWrapper</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nc">BasicSelectorContainer</span><span class="p">&gt;</span>
  <span class="p">);</span>
<span class="p">};</span>

</pre></table></code></div></div><p>Props의 전달만을 위한 Props전달이 보이는 코드인데 <code class="language-plaintext highlighter-rouge">BannerListPageSelectors</code>는</p><p><code class="language-plaintext highlighter-rouge">usePeriodSelector</code> 라는 훅에서 보내준 메서드와 상태 그 어느것도 사용하지 않는 것을 알 수 있으며</p><p>오직 PeriodSelector라는 컴포넌트에 이것들을 넘기기 위해서만 값을 Props를 받고 있다.</p><p>위 예제는 아주 단적인 예시인데 특정페이지에서는 의도치 않게 이것보다 뎁스가 깊어지는 경우도 있었다.</p><p>모든 개발을 위와같은 특정 UI Component + hooks를 통해 로직의 재활용성을 높이는 방식으로 진행했기에 이와 같은 Props Drilling 현상은 개발을 하기에 여간 귀찮은것이 아니었다.</p><p>그럼 마지막으로 PeriodSelector를 위한 로직이 구성된 별도의 훅까지 살펴보고 이를 어떻게 개선했는지를 살펴보자.</p><div lang="tsx" class="language-tsx highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
</pre><td class="rouge-code"><pre><span class="k">import</span> <span class="p">{</span> <span class="nx">PREV_MONTH</span><span class="p">,</span> <span class="nx">TODAY</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">constant/dateConstants</span><span class="dl">"</span><span class="p">;</span>
<span class="k">import</span> <span class="nx">React</span><span class="p">,</span> <span class="p">{</span> <span class="nx">useEffect</span><span class="p">,</span> <span class="nx">useState</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">react</span><span class="dl">"</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">dateAndTimeAssemble</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">utils/formatting</span><span class="dl">"</span><span class="p">;</span>

<span class="kd">const</span> <span class="nx">usePeriodSelector</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="p">[</span><span class="nx">date</span><span class="p">,</span> <span class="nx">setDate</span><span class="p">]</span> <span class="o">=</span> <span class="nx">useState</span><span class="o">&lt;</span><span class="p">[</span><span class="nb">Date</span><span class="p">,</span> <span class="nb">Date</span><span class="p">]</span><span class="o">&gt;</span><span class="p">([</span><span class="nx">PREV_MONTH</span><span class="p">,</span> <span class="nx">TODAY</span><span class="p">]);</span>
  <span class="kd">const</span> <span class="p">[</span><span class="nx">selectTime</span><span class="p">,</span> <span class="nx">setSelectTime</span><span class="p">]</span> <span class="o">=</span> <span class="nx">useState</span><span class="p">([</span><span class="dl">"</span><span class="s2">00:00</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">00:00</span><span class="dl">"</span><span class="p">]);</span>
  <span class="kd">const</span> <span class="p">[</span><span class="nx">assembleDate</span><span class="p">,</span> <span class="nx">setAssembleDate</span><span class="p">]</span> <span class="o">=</span> <span class="nx">useState</span><span class="o">&lt;</span><span class="p">[</span><span class="nb">Date</span><span class="p">,</span> <span class="nb">Date</span><span class="p">]</span><span class="o">&gt;</span><span class="p">([</span>
    <span class="k">new</span> <span class="nb">Date</span><span class="p">(),</span>
    <span class="k">new</span> <span class="nb">Date</span><span class="p">(),</span>
  <span class="p">]);</span>

  <span class="kd">const</span> <span class="nx">handleStartDate</span> <span class="o">=</span> <span class="p">(</span><span class="na">startDate</span><span class="p">:</span> <span class="nb">Date</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">setDate</span><span class="p">([</span><span class="nx">startDate</span><span class="p">,</span> <span class="nx">date</span><span class="p">[</span><span class="mi">1</span><span class="p">]]);</span>
  <span class="p">};</span>

  <span class="kd">const</span> <span class="nx">handleEndDate</span> <span class="o">=</span> <span class="p">(</span><span class="na">endDate</span><span class="p">:</span> <span class="nb">Date</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">setDate</span><span class="p">([</span><span class="nx">date</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nx">endDate</span><span class="p">]);</span>
  <span class="p">};</span>

  <span class="kd">const</span> <span class="nx">handleTime</span> <span class="o">=</span> <span class="p">(</span><span class="na">e</span><span class="p">:</span> <span class="nx">React</span><span class="p">.</span><span class="nx">ChangeEvent</span><span class="o">&lt;</span><span class="nx">HTMLInputElement</span><span class="o">&gt;</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="p">{</span> <span class="nx">name</span><span class="p">,</span> <span class="nx">value</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">e</span><span class="p">.</span><span class="nx">currentTarget</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">name</span> <span class="o">===</span> <span class="dl">"</span><span class="s2">startTime</span><span class="dl">"</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">setSelectTime</span><span class="p">([</span><span class="nx">value</span><span class="p">,</span> <span class="nx">selectTime</span><span class="p">[</span><span class="mi">1</span><span class="p">]]);</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">name</span> <span class="o">===</span> <span class="dl">"</span><span class="s2">endTime</span><span class="dl">"</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">setSelectTime</span><span class="p">([</span><span class="nx">selectTime</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nx">value</span><span class="p">]);</span>
    <span class="p">}</span>
  <span class="p">};</span>

  <span class="kd">const</span> <span class="nx">initializeDate</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">setDate</span><span class="p">([</span><span class="nx">PREV_MONTH</span><span class="p">,</span> <span class="nx">TODAY</span><span class="p">]);</span>
    <span class="nx">setSelectTime</span><span class="p">([</span><span class="dl">"</span><span class="s2">00:00</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">00:00</span><span class="dl">"</span><span class="p">]);</span>
  <span class="p">};</span>

  <span class="nx">useEffect</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="p">{</span> <span class="nx">startModifed</span><span class="p">,</span> <span class="nx">endModified</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">dateAndTimeAssemble</span><span class="p">({</span>
      <span class="na">startDate</span><span class="p">:</span> <span class="nx">date</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
      <span class="na">startTime</span><span class="p">:</span> <span class="nx">selectTime</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
      <span class="na">endDate</span><span class="p">:</span> <span class="nx">date</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
      <span class="na">endTime</span><span class="p">:</span> <span class="nx">selectTime</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
    <span class="p">});</span>

    <span class="nx">setAssembleDate</span><span class="p">([</span><span class="nx">startModifed</span><span class="p">,</span> <span class="nx">endModified</span><span class="p">]);</span>
  <span class="p">},</span> <span class="p">[</span><span class="nx">date</span><span class="p">,</span> <span class="nx">selectTime</span><span class="p">]);</span>
  <span class="k">return</span> <span class="p">{</span>
    <span class="na">state</span><span class="p">:</span> <span class="p">{</span>
      <span class="nx">date</span><span class="p">,</span>
      <span class="nx">assembleDate</span><span class="p">,</span>
      <span class="nx">selectTime</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="na">actions</span><span class="p">:</span> <span class="p">{</span>
      <span class="nx">setDate</span><span class="p">,</span>
      <span class="nx">setSelectTime</span><span class="p">,</span>
      <span class="nx">initializeDate</span><span class="p">,</span>
      <span class="nx">handleStartDate</span><span class="p">,</span>
      <span class="nx">handleEndDate</span><span class="p">,</span>
      <span class="nx">handleTime</span><span class="p">,</span>
    <span class="p">},</span>
  <span class="p">};</span>
<span class="p">};</span>

<span class="k">export</span> <span class="k">default</span> <span class="nx">usePeriodSelector</span><span class="p">;</span>
</pre></table></code></div></div><p>위와 같은 코드를 특정컴포넌트에 실행한 뒤 state와 actions를 빼와서 필요한용도로 사용할 수 있게 된다.</p><p>이렇게 중복된 로직을 계속 활용해나가는 방식을 차용했다.</p><p>그럼 이제 이 지옥같은 PropsDrilling을 ContextAPI와 함께 조금 더 우아하게 풀어보자.</p><h1 id="context-api를-적용하자">Context API를 적용하자</h1><h2 id="1-hooks에-컨텍스트를-추가해보자">1. hooks에 컨텍스트를 추가해보자</h2><div lang="tsx" class="language-tsx highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
</pre><td class="rouge-code"><pre><span class="k">import</span> <span class="p">{</span> <span class="nx">PREV_MONTH</span><span class="p">,</span> <span class="nx">TODAY</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">constant/dateConstants</span><span class="dl">'</span><span class="p">;</span>
<span class="k">import</span> <span class="nx">React</span><span class="p">,</span> <span class="p">{</span> <span class="nx">createContext</span><span class="p">,</span> <span class="nx">useEffect</span><span class="p">,</span> <span class="nx">useState</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">react</span><span class="dl">'</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">dateAndTimeAssemble</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">utils/formatting</span><span class="dl">'</span><span class="p">;</span>

<span class="kr">interface</span> <span class="nx">IPeriodContext</span> <span class="p">{</span>
  <span class="p">...</span><span class="nx">생략</span>
<span class="p">}</span> <span class="c1">//추가</span>

<span class="k">export</span> <span class="kd">const</span> <span class="nx">PeriodContext</span> <span class="o">=</span> <span class="nx">createContext</span><span class="o">&lt;</span><span class="nx">IPeriodContext</span> <span class="o">|</span> <span class="kc">undefined</span><span class="o">&gt;</span><span class="p">(</span>
  <span class="kc">undefined</span><span class="p">,</span>
<span class="p">);</span> <span class="c1">//추가</span>

<span class="kd">const</span> <span class="nx">usePeriodSelector</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="p">[</span><span class="nx">date</span><span class="p">,</span> <span class="nx">setDate</span><span class="p">]</span> <span class="o">=</span> <span class="nx">useState</span><span class="o">&lt;</span><span class="p">[</span><span class="nb">Date</span><span class="p">,</span> <span class="nb">Date</span><span class="p">]</span><span class="o">&gt;</span><span class="p">([</span><span class="nx">PREV_MONTH</span><span class="p">,</span> <span class="nx">TODAY</span><span class="p">]);</span>
  <span class="kd">const</span> <span class="p">[</span><span class="nx">selectTime</span><span class="p">,</span> <span class="nx">setSelectTime</span><span class="p">]</span> <span class="o">=</span> <span class="nx">useState</span><span class="p">([</span><span class="dl">'</span><span class="s1">00:00</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">00:00</span><span class="dl">'</span><span class="p">]);</span>

  <span class="p">...</span><span class="nx">생략</span>

  <span class="kd">const</span> <span class="nx">state</span> <span class="o">=</span> <span class="p">{</span>
    <span class="p">...</span><span class="nx">생략</span>
    <span class="nx">date</span><span class="p">,</span>
  <span class="p">};</span>

  <span class="kd">const</span> <span class="nx">actions</span> <span class="o">=</span> <span class="p">{</span>
    <span class="p">...</span><span class="nx">생략</span>
    <span class="nx">handleStartDate</span><span class="p">,</span>
    <span class="nx">handleEndDate</span><span class="p">,</span>
    <span class="nx">handleTime</span><span class="p">,</span>
  <span class="p">};</span>

  <span class="kd">const</span> <span class="nx">periodContextValue</span> <span class="o">=</span> <span class="p">{</span> <span class="nx">state</span><span class="p">,</span> <span class="nx">actions</span> <span class="p">};</span> <span class="c1">//추가</span>

  <span class="k">return</span> <span class="p">{</span>
    <span class="nx">state</span><span class="p">,</span>
    <span class="nx">actions</span><span class="p">,</span>
    <span class="nx">periodContextValue</span><span class="p">,</span>
  <span class="p">};</span>
<span class="p">};</span>

<span class="k">export</span> <span class="k">default</span> <span class="nx">usePeriodSelector</span><span class="p">;</span>

</pre></table></code></div></div><p>우선 createContext를 통해 PeriodContext를 만들어주고 해당하는 타입도 미리 만들어준다</p><p>나는 위 코드와 같이 state와 actions을 그냥 한무더기에 모아 contextValue로 사용할 것이라는 네이밍을 한뒤 hooks의 리턴값에 하나 추가해주었다.</p><p>이렇게 하면 추가된 부분은 총 3파트 정도된다</p><h2 id="2-컨텍스트-provider를-만들어주자">2. 컨텍스트 Provider를 만들어주자</h2><div lang="tsx" class="language-tsx highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
</pre><td class="rouge-code"><pre><span class="p">...</span>
<span class="k">import</span> <span class="nx">usePeriodSelector</span><span class="p">,</span> <span class="p">{</span> <span class="nx">PeriodContext</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">hooks/usePeriodSelector</span><span class="dl">'</span><span class="p">;</span>
<span class="p">...</span>

<span class="k">export</span> <span class="kd">const</span> <span class="nx">BannerList</span><span class="p">:</span> <span class="nx">React</span><span class="p">.</span><span class="nx">FC</span> <span class="o">=</span> <span class="p">():</span> <span class="nx">JSX</span><span class="p">.</span><span class="nx">Element</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="p">...</span>

  <span class="kd">const</span> <span class="p">{</span>
    <span class="p">...</span>
    <span class="nx">periodContextValue</span><span class="p">,</span>
  <span class="p">}</span> <span class="o">=</span> <span class="nx">usePeriodSelector</span><span class="p">();</span>

  <span class="p">...</span>

  <span class="k">return</span> <span class="p">(</span>
    <span class="p">&lt;&gt;</span>
    <span class="p">&lt;</span><span class="nc">PeriodContext</span><span class="p">.</span><span class="nc">Provider</span> <span class="na">value</span><span class="p">=</span><span class="si">{</span><span class="nx">periodContextValue</span><span class="si">}</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nc">BannerListPageSelectors</span>
        <span class="na">checkArr</span><span class="p">=</span><span class="si">{</span><span class="nx">checkArr</span><span class="si">}</span>
        <span class="c1">// date={date}</span>
        <span class="na">title</span><span class="p">=</span><span class="si">{</span><span class="nx">title</span><span class="si">}</span>
        <span class="na">register</span><span class="p">=</span><span class="si">{</span><span class="nx">register</span><span class="si">}</span>
        <span class="na">bannerType</span><span class="p">=</span><span class="si">{</span><span class="nx">bannerType</span><span class="si">}</span>
        <span class="na">isSearching</span><span class="p">=</span><span class="si">{</span><span class="nx">isSearching</span><span class="si">}</span>
        <span class="na">onSearch</span><span class="p">=</span><span class="si">{</span><span class="nx">onSearch</span><span class="si">}</span>
        <span class="na">onCancelSearch</span><span class="p">=</span><span class="si">{</span><span class="nx">initializeSearchData</span><span class="si">}</span>
        <span class="na">handleStatus</span><span class="p">=</span><span class="si">{</span><span class="nx">handleStatus</span><span class="si">}</span>
        <span class="na">handleInput</span><span class="p">=</span><span class="si">{</span><span class="nx">handleInput</span><span class="si">}</span>
        <span class="na">handleSelect</span><span class="p">=</span><span class="si">{</span><span class="nx">handleSelect</span><span class="si">}</span>
        <span class="c1">// handleEndDate={handleEndDate}</span>
        <span class="c1">// handleStartDate={handleStartDate}</span>
      <span class="p">/&gt;</span>
      <span class="p">&lt;/</span><span class="nc">PeriodContext</span><span class="p">.</span><span class="nc">Provider</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nc">BannerListTableList</span>
        <span class="na">data</span><span class="p">=</span><span class="si">{</span><span class="nx">listData</span> <span class="o">||</span> <span class="p">[]</span><span class="si">}</span>
        <span class="na">total</span><span class="p">=</span><span class="si">{</span><span class="nx">totalDataCount</span> <span class="o">||</span> <span class="mi">0</span><span class="si">}</span>
        <span class="na">doRefetch</span><span class="p">=</span><span class="si">{</span><span class="nx">doRefetch</span><span class="si">}</span>
      <span class="p">/&gt;</span>
    <span class="p">&lt;/&gt;</span>
  <span class="p">);</span>
<span class="p">};</span>

</pre></table></code></div></div><p>프로바이더를 만들어준 뒤 hooks에서 컨텍스트가 필요한 값을 빼와서 넣어준 것이다. 사실 더 낮은단위에서 제공해줘도 되지만 usePeriodSelector에서 나온 state값을 검색을위한 API호출에도 별도로 사용해야 하므로 위와 같은 구조가 만들어져 있다.</p><p>그리고 이제 어떻게 <code class="language-plaintext highlighter-rouge">BannerListPageSelectors</code>에서 기존에 있던 Props를 뺐는지 다른 변경된 코드도 한번 봐보자</p><h2 id="3-hooks와-한쌍이었던-컴포넌트에-context를-미리-심어놓자">3. Hooks와 한쌍이었던 컴포넌트에 Context를 미리 심어놓자</h2><div lang="tsx" class="language-tsx highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
</pre><td class="rouge-code"><pre><span class="k">import</span> <span class="nx">Calendar</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">components/calendar</span><span class="dl">"</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">PeriodContext</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">hooks/usePeriodSelector</span><span class="dl">"</span><span class="p">;</span>
<span class="k">import</span> <span class="nx">React</span><span class="p">,</span> <span class="p">{</span> <span class="nx">useContext</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">react</span><span class="dl">"</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">WrapperDate</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">./styles</span><span class="dl">"</span><span class="p">;</span>

<span class="kr">interface</span> <span class="nx">IPeriodSelectorProps</span> <span class="p">{</span>
  <span class="nl">withTimes</span><span class="p">:</span> <span class="nx">boolean</span><span class="p">;</span>
  <span class="nl">labelText</span><span class="p">?:</span> <span class="kr">string</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">const</span> <span class="nx">PeriodSelector</span><span class="p">:</span> <span class="nx">React</span><span class="p">.</span><span class="nx">FC</span><span class="o">&lt;</span><span class="nx">IPeriodSelectorProps</span><span class="o">&gt;</span> <span class="o">=</span> <span class="p">({</span>
  <span class="nx">withTimes</span><span class="p">,</span>
  <span class="nx">labelText</span><span class="p">,</span>
<span class="p">}):</span> <span class="nx">JSX</span><span class="p">.</span><span class="nx">Element</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">periodContext</span> <span class="o">=</span> <span class="nx">useContext</span><span class="p">(</span><span class="nx">PeriodContext</span><span class="p">);</span> <span class="c1">//여기</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">periodContext</span><span class="p">?.</span><span class="nx">state</span> <span class="o">||</span> <span class="o">!</span><span class="nx">periodContext</span><span class="p">?.</span><span class="nx">actions</span><span class="p">)</span>
    <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="dl">"</span><span class="s2">Period Context를 주입해주세요</span><span class="dl">"</span><span class="p">);</span>

  <span class="kd">const</span> <span class="p">{</span>
    <span class="na">state</span><span class="p">:</span> <span class="p">{</span> <span class="nx">date</span><span class="p">,</span> <span class="nx">selectTime</span> <span class="p">},</span>
    <span class="na">actions</span><span class="p">:</span> <span class="p">{</span> <span class="nx">handleStartDate</span><span class="p">,</span> <span class="nx">handleEndDate</span><span class="p">,</span> <span class="nx">handleTime</span> <span class="p">},</span>
  <span class="p">}</span> <span class="o">=</span> <span class="nx">periodContext</span><span class="p">;</span> <span class="c1">//여기</span>

  <span class="k">return</span> <span class="p">(</span>
    <span class="p">&lt;</span><span class="nc">WrapperDate</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">span</span><span class="p">&gt;</span><span class="si">{</span><span class="nx">labelText</span> <span class="o">||</span> <span class="dl">"</span><span class="s2">기간 선택</span><span class="dl">"</span><span class="si">}</span><span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
          <span class="p">&lt;</span><span class="nc">Calendar</span>
            <span class="na">date</span><span class="p">=</span><span class="si">{</span><span class="nx">date</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">||</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">()</span><span class="si">}</span>
            <span class="na">handleDate</span><span class="p">=</span><span class="si">{</span><span class="nx">handleStartDate</span> <span class="o">||</span> <span class="p">(()</span> <span class="o">=&gt;</span> <span class="kc">null</span><span class="p">)</span><span class="si">}</span>
          <span class="p">/&gt;</span>
          <span class="si">{</span><span class="nx">withTimes</span> <span class="o">&amp;&amp;</span> <span class="nx">handleTime</span> <span class="o">&amp;&amp;</span> <span class="nx">selectTime</span> <span class="o">&amp;&amp;</span> <span class="p">(</span>
            <span class="p">&lt;</span><span class="nt">input</span>
              <span class="na">type</span><span class="p">=</span><span class="s">"time"</span>
              <span class="na">value</span><span class="p">=</span><span class="si">{</span><span class="nx">selectTime</span> <span class="o">&amp;&amp;</span> <span class="nx">selectTime</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span>
              <span class="na">name</span><span class="p">=</span><span class="s">"startTime"</span>
              <span class="na">onChange</span><span class="p">=</span><span class="si">{</span><span class="nx">handleTime</span><span class="si">}</span>
            <span class="p">/&gt;</span>
          <span class="p">)</span><span class="si">}</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        ...
      <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nc">WrapperDate</span><span class="p">&gt;</span>
  <span class="p">);</span>
<span class="p">};</span>

<span class="k">export</span> <span class="k">default</span> <span class="nx">PeriodSelector</span><span class="p">;</span>
</pre></table></code></div></div><p>이제 위와 같은 방식으로 Hooks파일에 선언해놓았던 Context를 불러와 에러핸들링을 한번해주고 나머지 값들을 편안하게 사용할 수 있다.</p><p>Props의 개수가 확연히 준것을 알 수 있다. 사실 여기까지는 문제가 되지 않았다.</p><h1 id="문제점">문제점</h1><p>렌더링에 대한 문제가 생긴다. ContextAPI는 Sugar Syntax와 비슷하게 실제로 코드상에서는 PropsDrilling을 하지 않지만 사실상 그와 같은 행위를 하고 있어 하나의 컨텍스트만 바뀌어도 해당 컨텍스트를 참조하고 있는 모든 부분에서 리렌더링이 일어난다. 이는 아래와 같이 해결할 수 있다.</p><h2 id="memoizing을-위한-컨테이너-만들기">Memoizing을 위한 컨테이너 만들기</h2><div lang="tsx" class="language-tsx highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
</pre><td class="rouge-code"><pre><span class="k">import</span> <span class="p">{</span> <span class="nx">PeriodContext</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">hooks/usePeriodSelector</span><span class="dl">"</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">useContext</span><span class="p">,</span> <span class="nx">useMemo</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">react</span><span class="dl">"</span><span class="p">;</span>

<span class="kr">interface</span> <span class="nx">IMemoizePeriodSelectorContainerProps</span> <span class="p">{</span>
  <span class="nl">children</span><span class="p">:</span> <span class="nx">React</span><span class="p">.</span><span class="nx">ReactNode</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">const</span> <span class="nx">MemoizePeriodSelectorContainer</span><span class="p">:</span> <span class="nx">React</span><span class="p">.</span><span class="nx">FC</span><span class="o">&lt;</span>
  <span class="nx">IMemoizePeriodSelectorContainerProps</span>
<span class="o">&gt;</span> <span class="o">=</span> <span class="p">({</span> <span class="nx">children</span> <span class="p">})</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">periodContext</span> <span class="o">=</span> <span class="nx">useContext</span><span class="p">(</span><span class="nx">PeriodContext</span><span class="p">);</span>
  <span class="k">return</span> <span class="nx">useMemo</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">&lt;&gt;</span><span class="si">{</span><span class="nx">children</span><span class="si">}</span><span class="p">&lt;/&gt;;</span>
  <span class="p">},</span> <span class="p">[</span>
    <span class="nx">periodContext</span><span class="p">?.</span><span class="nx">state</span><span class="p">.</span><span class="nx">date</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
    <span class="nx">periodContext</span><span class="p">?.</span><span class="nx">state</span><span class="p">.</span><span class="nx">date</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
    <span class="nx">periodContext</span><span class="p">?.</span><span class="nx">state</span><span class="p">.</span><span class="nx">selectTime</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
    <span class="nx">periodContext</span><span class="p">?.</span><span class="nx">state</span><span class="p">.</span><span class="nx">selectTime</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
  <span class="p">]);</span>
<span class="p">};</span>

<span class="k">export</span> <span class="k">default</span> <span class="nx">MemoizePeriodSelectorContainer</span><span class="p">;</span>
</pre></table></code></div></div><p>원시값까지 가야하므로… 의존배열에 값이 좀 많다.</p><p>이렇게 useMemo를 활용해서 컴포넌트를 메모이징 하여 해당 스테이트가 변경될때만 리렌더 시키는 방식으로 활용할 수도 있다.</p><p>이것을 아래와같이 해당 컴포넌트에 적용시켜주면 된다.</p><p>이렇게하면 return부분에 들어가는 캘린더와 같은부분은 리렌더가 되지 않아 렌더링 최적화를 어느정도 적용할 수 있다.</p><p>다만 주의해야하는 점은 memoize된 방식의 사용을 위해서 useMemo를 적용할 때,</p><p>위에서 만든것과 유사한 MemoizeContainer를 사용하는 경우 useContext를 통해 실제로 불러와 값을 넣어주는 부분 이하의 뎁스에서 이를 감싸줘야한다는 것이다</p><div lang="tsx" class="language-tsx highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
</pre><td class="rouge-code"><pre><span class="k">import</span> <span class="nx">Calendar</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">components/calendar</span><span class="dl">"</span><span class="p">;</span>
<span class="k">import</span> <span class="nx">MemoizePeriodSelectorContainer</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">components/common/MemoizePeriodSelectorContainer</span><span class="dl">"</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">PeriodContext</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">hooks/usePeriodSelector</span><span class="dl">"</span><span class="p">;</span>
<span class="k">import</span> <span class="nx">React</span><span class="p">,</span> <span class="p">{</span> <span class="nx">useContext</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">react</span><span class="dl">"</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">WrapperDate</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">./styles</span><span class="dl">"</span><span class="p">;</span>

<span class="kr">interface</span> <span class="nx">IPeriodSelectorProps</span> <span class="p">{</span>
  <span class="nl">withTimes</span><span class="p">:</span> <span class="nx">boolean</span><span class="p">;</span>
  <span class="nl">labelText</span><span class="p">?:</span> <span class="kr">string</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">const</span> <span class="nx">PeriodSelector</span><span class="p">:</span> <span class="nx">React</span><span class="p">.</span><span class="nx">FC</span><span class="o">&lt;</span><span class="nx">IPeriodSelectorProps</span><span class="o">&gt;</span> <span class="o">=</span> <span class="p">({</span>
  <span class="nx">withTimes</span><span class="p">,</span>
  <span class="nx">labelText</span><span class="p">,</span>
<span class="p">}):</span> <span class="nx">JSX</span><span class="p">.</span><span class="nx">Element</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">periodContext</span> <span class="o">=</span> <span class="nx">useContext</span><span class="p">(</span><span class="nx">PeriodContext</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">periodContext</span><span class="p">?.</span><span class="nx">state</span> <span class="o">||</span> <span class="o">!</span><span class="nx">periodContext</span><span class="p">?.</span><span class="nx">actions</span><span class="p">)</span>
    <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="dl">"</span><span class="s2">Period Context를 주입해주세요</span><span class="dl">"</span><span class="p">);</span>

  <span class="kd">const</span> <span class="p">{</span>
    <span class="na">state</span><span class="p">:</span> <span class="p">{</span> <span class="nx">date</span><span class="p">,</span> <span class="nx">selectTime</span> <span class="p">},</span>
    <span class="na">actions</span><span class="p">:</span> <span class="p">{</span> <span class="nx">handleStartDate</span><span class="p">,</span> <span class="nx">handleEndDate</span><span class="p">,</span> <span class="nx">handleTime</span> <span class="p">},</span>
  <span class="p">}</span> <span class="o">=</span> <span class="nx">periodContext</span><span class="p">;</span>

  <span class="k">return</span> <span class="p">(</span>
    <span class="c1">//periodContext를 사용하는 해당 컴포넌트의 리턴부분 또는 그 아래의 Calendar컴포넌트</span>
    <span class="p">&lt;</span><span class="nc">MemoizePeriodSelectorContainer</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nc">WrapperDate</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">span</span><span class="p">&gt;</span><span class="si">{</span><span class="nx">labelText</span> <span class="o">||</span> <span class="dl">'</span><span class="s1">기간 선택</span><span class="dl">'</span><span class="si">}</span><span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
          <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nc">Calendar</span>
              <span class="na">date</span><span class="p">=</span><span class="si">{</span><span class="nx">date</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">||</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">()</span><span class="si">}</span>
              <span class="na">handleDate</span><span class="p">=</span><span class="si">{</span><span class="nx">handleStartDate</span> <span class="o">||</span> <span class="p">(()</span> <span class="o">=&gt;</span> <span class="kc">null</span><span class="p">)</span><span class="si">}</span>
            <span class="p">/&gt;</span>
            <span class="si">{</span><span class="nx">withTimes</span> <span class="o">&amp;&amp;</span> <span class="nx">handleTime</span> <span class="o">&amp;&amp;</span> <span class="nx">selectTime</span> <span class="o">&amp;&amp;</span> <span class="p">(</span>
              <span class="p">&lt;</span><span class="nt">input</span>
                <span class="na">type</span><span class="p">=</span><span class="s">"time"</span>
                <span class="na">value</span><span class="p">=</span><span class="si">{</span><span class="nx">selectTime</span> <span class="o">&amp;&amp;</span> <span class="nx">selectTime</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span>
                <span class="na">name</span><span class="p">=</span><span class="s">"startTime"</span>
                <span class="na">onChange</span><span class="p">=</span><span class="si">{</span><span class="nx">handleTime</span><span class="si">}</span>
              <span class="p">/&gt;</span>
            <span class="p">)</span><span class="si">}</span>
          <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
            ...
          <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
      <span class="p">&lt;/</span><span class="nc">WrapperDate</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="err">/</span><span class="na">MemoizePeriodSelectorContainer</span><span class="p">&gt;</span>
  );
};

export default React.memo(PeriodSelector);
</pre></table></code></div></div><p>이렇게 해서 마침내 hooks를 통해 분리했던 로직을 PropsDrilling없이, 그리고 스코프를 정해서 사용하는것이 가능해졌다.</p><h2 id="왜-이렇게-까지해서-contextapi를-쓰는걸까">왜 이렇게 까지해서 ContextAPI를 쓰는걸까?</h2><p>Redux-Toolkit, Recoil, Atomic등 전역상태관리를 도와주는 아주 좋은 라이브러리들이 많다.</p><p>이 라이브러리들은 객체 세부사항에 필요한 값만 가져온다면 해당 값이 변할때만 리렌더링을 최적화 시켜서 해주기도하고 포트폴리오에 스킬셋을 하나라도 더 적을 수 있으니 아주 좋은선택이다.</p><p>그런데 내가 ContextAPI를 굳이 사용한 이유는 다른의미로 있다.</p><p>크게 웹을 본다면 대부분은 대개 비슷한 구조를 아래와 같이 가져갈 것이다.</p><div lang="md" class="language-md highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
</pre><td class="rouge-code"><pre><span class="p">-</span> src
<span class="p">  -</span> Page
<span class="p">    -</span> Home
<span class="p">    -</span> About
<span class="p">      -</span> components
        Component.tsx
        ...
<span class="p">      -</span> style
        styleA.tsx
        styleB.tsx
        ...
<span class="p">      -</span> hooks
        useSomeHookA.ts
        ...
<span class="p">      -</span> constants
        constantA.ts
        ...
<span class="p">    -</span> Post
<span class="p">  -</span> components
    common
    CommonA.tsx
    ...
</pre></table></code></div></div><p>개인적으로는 페이지별로 사용하는 스타일, 상수, 유틸, hooks등을 페이지 아래에 폴더로 구성하여 필요한 곳에 가져다 쓰고</p><p>중복이 되어 공용으로 사용이 되는 경우 src 바로 하단에 있는 폴더에 넣어 적절한 네이밍을 통해 공통으로 사용하는 방식을 취하고 있다.</p><p>이 때, 위 예제와 같은 <code class="language-plaintext highlighter-rouge">usePeriodSelectors</code> 는 공용 hook이 될 것인데, 이를 사용하는 <code class="language-plaintext highlighter-rouge">페이지</code> 는 <code class="language-plaintext highlighter-rouge">해당 컴포넌트(PeriodSelector.tsx)</code>를 사용하는 페이지 일 것이다.</p><p>그렇다면 hook + component의 조합으로 중복된 코드를 작성하지 않고 필요한곳에 import하여 로직과 뷰를 계속 재활용하며 사용할 수 있으므로 생산성이 상당히 높아진다.</p><p>그런데 여기서 usePeriodSelectors라는 관련 state를 PropsDrilling을 피하고자 하는 이유로만 전역 store에 저장하고 있다고 가정하면 해당 컴포넌트를 사용하지 않는 페이지에서도 이 state에 대한 접근이 가능하게 된다.</p><p>이는 해당 Hooks가 가진 서비스로직의 범주를 벗어나는 곳에서 사용(접근)이 되는 것이기 때문에 공동작업인 경우 자칫 의도하지 않는 역할이 시행될 수도 있다고 판단했다.</p><p>(물론 그럴일은 절대 없겠지만 각 파일의 롤을 명확히 하고 싶은마음이 제일 컸다.)</p><p>추가로 리액트가 함수지향적으로 개발이 되는것이 현재이나, 객체지향의 SOLID의 일부처럼 단일 책임(SRP)을 가지는 것이 중요하다고 판단하고 있는 개인적의견이 있다.</p><p>때문에 해당 뷰에 해당하는 로직만 가지는것이 중요하다고 생각하고 있어 전역 저장소(Global Store)에 이를 저장하는것은 접근성의 문제로 의미가 맞지 않다고 판단되었다.</p><p>그래서 해당 컴포넌트를 쓰는곳은 해당 컨텍스트 프로바이더를 통해 state를 주입받고 해당 컴포넌트는 항상 이 컨텍스트의 값만 쓰도록 설계를 한다면,</p><p>적어도 반복되어 사용되는 컴포넌트는 해당 state만을 관리하므로 의미가 맞다고 생각한다.</p><h1 id="장점과-단점">장점과 단점</h1><h2 id="--장점">- 장점</h2><ul><li>Props Drilling을 피하며 깔끔한 코드상태를 유지할 수 있다.<li>Nest.js의 컨셉과 유사한 느낌(OOP)으로 필요한 로직이 있다면 Service를 주입하는 것과 같은 느낌의 개발이 가능하다.</ul><h2 id="--단점">- 단점</h2><ul><li>렌더링 최적화 하는 것에 손이 더욱 더 간다. (제발 memo의 콜백함수로 Context도 인지가 되는 날이 왔으면 좋겠다.)<li>자칫남용하면 return구문에서 여러개의 Provider를 동시에 만나게되므로 심미적으로 좋지 않다.</ul><h1 id="참고">참고</h1><ul><li><a href="https://github.com/facebook/react/issues/15156">Github - facebook/react #15156 Preventing rerenders with React.memo and useContext hook</a><li><a href="https://kentcdodds.com/blog/how-to-use-react-context-effectively">Kent C. Dodds - How to use React Context effectively</a><li><a href="https://blog.agney.dev/useMemo-inside-context/">useMemo inside Context API - React - The Mindless</a></ul></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/fe/'>FE</a>, <a href='/categories/react/'>React</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/architecture/" class="post-tag no-text-decoration" >Architecture</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=리액트에서 비즈니스 로직을 나눠보자[3 - ContextAPI마저 활용해보자] - Sanghun Lee&url=https://sanghunlee-711.github.io//posts/refactoring-3/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=리액트에서 비즈니스 로직을 나눠보자[3 - ContextAPI마저 활용해보자] - Sanghun Lee&u=https://sanghunlee-711.github.io//posts/refactoring-3/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=리액트에서 비즈니스 로직을 나눠보자[3 - ContextAPI마저 활용해보자] - Sanghun Lee&url=https://sanghunlee-711.github.io//posts/refactoring-3/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink('', 'Link copied successfully!')" data-toggle="tooltip" data-placement="top" title="Copy link"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"> <span>Recent Update</span><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/refactoring-2/">리액트에서 비즈니스 로직을 나눠보자[2 - Hooks 를 테스트 해보자]</a><li><a href="/posts/refactoring-1/">리액트에서 비즈니스 로직을 나눠보자[1 - 비즈니스로직 분리]</a><li><a href="/posts/webpack2/">Webpack과 React를 사용하여 Custome Element 만들기[2 - 웹팩(플러그인)]</a><li><a href="/posts/webpack3/">Webpack과 React를 사용하여 Custome Element 만들기[3 - 커스텀엘리먼트 렌더]</a><li><a href="/posts/nextjs_basic/">Next JS를 공부해보자[1편]</a></ul></div><div id="access-tags"> <span>Trending Tags</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/architecture/">Architecture</a> <a class="post-tag" href="/tags/webpack/">Webpack</a> <a class="post-tag" href="/tags/next-js/">Next JS</a> <a class="post-tag" href="/tags/algorithm/">Algorithm</a> <a class="post-tag" href="/tags/cors/">Cors</a> <a class="post-tag" href="/tags/cypress/">Cypress</a> <a class="post-tag" href="/tags/fe-test/">FE Test</a> <a class="post-tag" href="/tags/jest/">Jest</a> <a class="post-tag" href="/tags/msw/">msw</a> <a class="post-tag" href="/tags/prefilght/">Prefilght</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/refactoring-1/"><div class="card-body"> <span class="timeago small" >Dec 15, 2021<i class="unloaded">2021-12-15T12:33:00+09:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>리액트에서 비즈니스 로직을 나눠보자[1 - 비즈니스로직 분리]</h3><div class="text-muted small"><p> 왜 하게 되었냐면 회사에서 개발자 다수가 이탈하게 되면서 빠른 유지보수와 코드의 정확성을 높이는 일이 나에게도, 회사에게도 중요해졌다. 현재 리액트 프로젝트에서 Toolkit과 Saga를 통해서 나름 나눈다고 나눴지만 이 과정에서 불필요한 코드들도 많아졌고, 실제로 state나 hooks와 연결된 부분은 컴포넌트에 그대로 남아있게 되었다. 그래서...</p></div></div></a></div><div class="card"> <a href="/posts/refactoring-2/"><div class="card-body"> <span class="timeago small" >Jan 18<i class="unloaded">2022-01-18T12:33:00+09:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>리액트에서 비즈니스 로직을 나눠보자[2 - Hooks 를 테스트 해보자]</h3><div class="text-muted small"><p> 테스트 코드 작성해보기 이제 비즈니스로직을 모두 나누었으니 해당 비즈니스 로직에 대해서만 테스트를 진행해보자 여러 테크기업들의 블로그를 뒤적이다. 리디의 블로그글을 가장 많이 참고하였다. 그리하여 redux-mockstore와 testing-library/react-hooks 를 이용하여 테스트를 진행했다. 우선 간단한 설명은 아래와 같다. ...</p></div></div></a></div><div class="card"> <a href="/posts/webpack2/"><div class="card-body"> <span class="timeago small" >Sep 18, 2021<i class="unloaded">2021-09-18T12:33:00+09:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Webpack과 React를 사용하여 Custome Element 만들기[2 - 웹팩(플러그인)]</h3><div class="text-muted small"><p> Webpack 1. 사용한 플러그인(plugins) 플러그인은 번들된 파일을 처리하기 위해 사용하는 것이다. 각 플러그인의 개념은 간단하게 적고 넘어가겠다. 1.1 CleanWebpackPlugin 이 플러그인은 출력 Path(output)으로 정해놓은 것의 모든파일을 지워주고 리빌드 완료 후 사용되지않는 이미지 파일등의 webpack asse...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/refactoring-2/" class="btn btn-outline-primary" prompt="Older"><p>리액트에서 비즈니스 로직을 나눠보자[2 - Hooks 를 테스트 해보자]</p></a> <span class="btn btn-outline-primary disabled" prompt="Newer"><p>-</p></span></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2022 <a href="https://github.com/sanghunlee-711">Sanghun lee</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/architecture/">Architecture</a> <a class="post-tag" href="/tags/webpack/">Webpack</a> <a class="post-tag" href="/tags/next-js/">Next JS</a> <a class="post-tag" href="/tags/algorithm/">Algorithm</a> <a class="post-tag" href="/tags/cors/">Cors</a> <a class="post-tag" href="/tags/cypress/">Cypress</a> <a class="post-tag" href="/tags/fe-test/">FE Test</a> <a class="post-tag" href="/tags/jest/">Jest</a> <a class="post-tag" href="/tags/msw/">msw</a> <a class="post-tag" href="/tags/prefilght/">Prefilght</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><script src="https://cdn.jsdelivr.net/npm/mermaid@8/dist/mermaid.min.js"></script> <script> $(function() { let initTheme = "default"; if ($("html[mode=dark]").length > 0 || ($("html[mode]").length == 0 && window.matchMedia("(prefers-color-scheme: dark)").matches ) ) { initTheme = "dark"; } let mermaidConf = { theme: initTheme /* <default|dark|forest|neutral> */ }; /* Markdown converts to HTML */ $("pre").has("code.language-mermaid").each(function() { let svgCode = $(this).children().html(); $(this).addClass("unloaded"); $(this).after(`<div class=\"mermaid\">${svgCode}</div>`); }); mermaid.initialize(mermaidConf); }); </script><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://sanghunlee-711.github.io/{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script> /* see: <https://docs.mathjax.org/en/latest/options/input/tex.html#tex-options> */ MathJax = { tex: { inlineMath: [ /* start/end delimiter pairs for in-line math */ ['$','$'], ['\\(','\\)'] ], displayMath: [ /* start/end delimiter pairs for display math */ ['$$', '$$'], ['\\[', '\\]'] ] } }; </script> <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script type="text/javascript" id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"> </script> <script src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.16.1,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id="></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', ''); }); </script>
